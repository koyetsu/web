{% extends 'base.html' %}
{% block extra_head %}
  <style>
    .admin-dashboard {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
      display: grid;
      gap: 2.5rem;
    }

    .admin-dashboard h1 {
      margin-bottom: 0.5rem;
    }

    .admin-intro {
      display: grid;
      gap: 0.75rem;
    }

    .admin-sections {
      display: grid;
      gap: 2rem;
    }

    .section-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 1.75rem;
      box-shadow: 0 25px 65px -45px rgba(15, 23, 42, 0.45);
      display: grid;
      gap: 1.5rem;
    }

    .section-card[data-section] {
      border: 1px solid rgba(148, 163, 184, 0.18);
    }

    .section-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1.5rem;
    }

    .section-toolbar h2 {
      margin: 0;
      font-size: 1.3rem;
      color: var(--primary-dark);
    }

    .section-toolbar p {
      margin: 0.35rem 0 0;
      color: var(--muted);
    }

    .edit-toggle {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: #ffffff;
      color: var(--primary-dark);
      padding: 0.35rem 1rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      transition: all 0.2s ease-in-out;
    }

    .edit-toggle::before {
      content: '\270E';
      font-size: 0.9rem;
    }

    .section-card.is-editing .edit-toggle {
      background: var(--primary);
      border-color: transparent;
      color: #ffffff;
      box-shadow: 0 12px 20px -12px rgba(37, 99, 235, 0.7);
    }

    .section-card.is-editing .edit-toggle::before {
      content: '\2713';
    }

    .section-preview {
      border: 2px dashed rgba(148, 163, 184, 0.25);
      border-radius: 16px;
      padding: 1rem 1.25rem;
      background: rgba(241, 245, 249, 0.6);
      display: grid;
      gap: 1rem;
      transition: all 0.2s ease-in-out;
    }

    .section-card.is-editing .section-preview {
      border-color: rgba(37, 99, 235, 0.45);
      background: rgba(59, 130, 246, 0.08);
    }

    .preview-grid {
      display: grid;
      gap: 0.75rem;
    }

    .preview-grid dl {
      margin: 0;
      display: grid;
      gap: 0.15rem;
    }

    .preview-grid dt {
      font-weight: 600;
      font-size: 0.85rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .preview-grid dd {
      margin: 0;
    }

    .preview-list {
      margin: 0;
      padding-left: 1rem;
      color: var(--primary-dark);
      display: grid;
      gap: 0.25rem;
    }

    .color-swatches {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.75rem;
    }

    .color-swatch {
      display: grid;
      gap: 0.35rem;
      font-size: 0.9rem;
    }

    .color-swatch .swatch-label {
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-weight: 600;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .color-swatch .swatch-color {
      border-radius: 12px;
      height: 36px;
      border: 1px solid rgba(15, 23, 42, 0.08);
    }

    .color-swatch .swatch-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
    }

    .field-help {
      display: block;
      margin-top: 0.35rem;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .section-body {
      display: none;
      gap: 1.5rem;
    }

    .section-card.is-editing .section-body {
      display: grid;
    }

    .form-fields {
      display: grid;
      gap: 1rem;
    }

    .form-fields label {
      display: grid;
      gap: 0.4rem;
      font-weight: 600;
    }

    .form-fields input,
    .form-fields textarea,
    .form-fields select {
      padding: 0.75rem 1rem;
      border-radius: 12px;
      border: 1px solid rgba(100, 116, 139, 0.25);
      font: inherit;
      resize: vertical;
      background: #ffffff;
    }

    .form-fields textarea {
      min-height: 120px;
    }

    .collection-wrapper {
      position: relative;
      border: 2px dashed rgba(148, 163, 184, 0.35);
      border-radius: 18px;
      padding: 1rem;
      display: grid;
      gap: 1rem;
      background: rgba(248, 250, 252, 0.55);
      transition: all 0.2s ease-in-out;
    }

    .collection-wrapper:hover {
      border-color: rgba(37, 99, 235, 0.6);
      background: rgba(59, 130, 246, 0.08);
    }

    .collection {
      display: grid;
      gap: 1rem;
    }

    .collection-item {
      border: 1px solid rgba(100, 116, 139, 0.25);
      border-radius: 16px;
      padding: 1rem;
      display: grid;
      gap: 0.75rem;
      background: #ffffff;
      box-shadow: 0 18px 40px -38px rgba(15, 23, 42, 0.6);
    }

    .collection-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      font-weight: 600;
    }

    .collection-item button.remove-item {
      background: none;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 0.9rem;
    }

    .add-item {
      justify-self: center;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid rgba(37, 99, 235, 0.45);
      border-radius: 999px;
      padding: 0.35rem 1.1rem 0.35rem 0.6rem;
      font-weight: 600;
      color: var(--primary-dark);
      background: #ffffff;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      opacity: 0;
      transform: translateY(-8px);
    }

    .add-item::before {
      content: '+';
      width: 1.75rem;
      height: 1.75rem;
      border-radius: 999px;
      background: var(--primary);
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    .collection-wrapper:hover .add-item,
    .section-card.is-editing .collection-wrapper .add-item {
      opacity: 1;
      transform: translateY(0);
    }

    .admin-actions {
      display: flex;
      justify-content: flex-end;
      padding-top: 0.5rem;
    }

    .admin-actions button {
      padding-inline: 2.5rem;
    }

    .alert {
      background: rgba(34, 197, 94, 0.12);
      color: #15803d;
      padding: 0.85rem 1rem;
      border-radius: 12px;
      font-weight: 600;
    }

    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }

    .image-grid figure {
      border: 1px solid rgba(100, 116, 139, 0.2);
      border-radius: 14px;
      padding: 1rem;
      background: #ffffff;
      display: grid;
      gap: 0.5rem;
      justify-items: center;
    }

    .image-grid img {
      max-width: 100%;
      border-radius: 8px;
    }

    .color-inputs {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }

    .color-inputs label {
      align-items: center;
      grid-template-columns: 1fr auto;
    }

    .color-inputs input[type='color'] {
      width: 52px;
      height: 36px;
      padding: 0;
      border: none;
      background: none;
    }

    .file-note {
      font-size: 0.9rem;
      color: var(--muted);
    }

    @media (max-width: 720px) {
      .section-toolbar {
        flex-direction: column;
        align-items: stretch;
      }

      .edit-toggle {
        justify-content: center;
      }

      .section-preview {
        padding: 1rem;
      }
    }
  </style>
{% endblock %}
{% block content %}
  <section class="admin-dashboard">
    <div class="admin-intro">
      <h1>Content management</h1>
      <p>Hover a section to reveal quick add controls and click <strong>Edit section</strong> to update copy, colors, and lists. Changes are saved to <code>{{ webroot_path }}/content.json</code>.</p>
      {% if message %}
        <div class="alert">{{ message }}</div>
      {% endif %}
    </div>

    <form method="post" class="admin-sections">
      <input type="hidden" name="action" value="update_content" />
      <datalist id="media-options">
        <option value=""></option>
        {% for upload in uploads %}
          <option value="/uploads/{{ upload }}">/uploads/{{ upload }}</option>
        {% endfor %}
      </datalist>

      <article class="section-card is-editing" data-section>
        <div class="section-toolbar">
          <div>
            <h2>Admin access</h2>
            <p>Manage the password required to sign in</p>
          </div>
          <button type="button" class="edit-toggle" aria-expanded="true">Done</button>
        </div>
        <div class="section-preview">
          <div class="preview-grid">
            <dl>
              <dt>Password status</dt>
              <dd>
                {% if admin_password_state == 'custom' %}
                  Custom password set
                {% elif admin_password_state == 'empty' %}
                  Password cleared (no password required)
                {% else %}
                  Using default password
                {% endif %}
              </dd>
            </dl>
          </div>
        </div>
        <div class="section-body">
          <div class="form-fields">
            <label>
              Set new admin password
              <input type="password" name="admin_password" placeholder="Enter new password" autocomplete="new-password" />
              <span class="field-help">Leave blank to keep the existing password. Launch with <code>--clear-admin-password</code> to reset to the default.</span>
            </label>
          </div>
        </div>
      </article>

      <article class="section-card is-editing" data-section>
        <div class="section-toolbar">
          <div>
            <h2>Site identity &amp; theme</h2>
            <p>Brand, navigation, and global colors</p>
          </div>
          <button type="button" class="edit-toggle" aria-expanded="true">Done</button>
        </div>
        <div class="section-preview">
          <div class="preview-grid">
            <dl>
              <dt>Business name</dt>
              <dd>{{ content.site.name }}</dd>
            </dl>
            <dl>
              <dt>Tagline</dt>
              <dd>{{ content.site.tagline or '–' }}</dd>
            </dl>
            <div class="color-swatches">
              <div class="color-swatch">
                <span class="swatch-label">Primary</span>
                <span class="swatch-color" style="background: {{ content.site.colors.primary }}"></span>
                <span class="swatch-value">{{ content.site.colors.primary }}</span>
              </div>
              <div class="color-swatch">
                <span class="swatch-label">Accent</span>
                <span class="swatch-color" style="background: {{ content.site.colors.accent }}"></span>
                <span class="swatch-value">{{ content.site.colors.accent }}</span>
              </div>
              <div class="color-swatch">
                <span class="swatch-label">Background</span>
                <span class="swatch-color" style="background: {{ content.site.colors.background }}"></span>
                <span class="swatch-value">{{ content.site.colors.background }}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="section-body">
          <div class="form-fields">
            <label>
              Business name
              <input type="text" name="site_name" value="{{ content.site.name }}" required />
            </label>
            <label>
              Tagline
              <input type="text" name="site_tagline" value="{{ content.site.tagline }}" />
            </label>
          </div>
          <div class="form-fields">
            <label>
              Footer description
              <textarea name="footer_description">{{ content.site.footer.description }}</textarea>
            </label>
          </div>
          <div class="color-inputs">
            <label>
              Primary
              <input type="color" name="color_primary" value="{{ content.site.colors.primary }}" />
            </label>
            <label>
              Primary (dark)
              <input type="color" name="color_primary_dark" value="{{ content.site.colors.primary_dark }}" />
            </label>
            <label>
              Accent
              <input type="color" name="color_accent" value="{{ content.site.colors.accent }}" />
            </label>
            <label>
              Background
              <input type="color" name="color_background" value="{{ content.site.colors.background }}" />
            </label>
            <label>
              Text
              <input type="color" name="color_text" value="{{ content.site.colors.text }}" />
            </label>
            <label>
              Muted text
              <input type="color" name="color_muted" value="{{ content.site.colors.muted }}" />
            </label>
          </div>
          <div class="form-fields">
            <label>
              Footer visit lines (one per row)
              <textarea name="footer_visit_lines">{{ content.site.footer.visit.lines | join('\n') }}</textarea>
            </label>
            <label>
              Footer contact lines (Label|URL — leave URL empty for plain text)
              <textarea name="footer_contact_lines">{% for line in content.site.footer.contact.lines %}{{ line.label }}{% if line.url %}|{{ line.url }}{% endif %}{% if not loop.last %}\n{% endif %}{% endfor %}</textarea>
            </label>
          </div>
        </div>
      </article>

      <article class="section-card" data-section>
        <div class="section-toolbar">
          <div>
            <h2>Home page</h2>
            <p>Hero, services overview, trust builders</p>
          </div>
          <button type="button" class="edit-toggle" aria-expanded="false">Edit section</button>
        </div>
        <div class="section-preview">
          <div class="preview-grid">
            <dl>
              <dt>Hero title</dt>
              <dd>{{ home.hero.title }}</dd>
            </dl>
            <dl>
              <dt>Hero call-to-action</dt>
              <dd>{{ home.hero.cta_text or '–' }}</dd>
            </dl>
            <ul class="preview-list">
              <li>{{ home['what_we_print'].title }} ({{ home['what_we_print']['items'] | length }} cards)</li>
              <li>{{ home['why_choose'].title }} ({{ home['why_choose']['items'] | length }} highlights)</li>
              <li>{{ home['testimonials'].title }} ({{ home['testimonials']['items'] | length }} quotes)</li>
            </ul>
          </div>
        </div>
        <div class="section-body">
          <div class="form-fields">
            <label>Hero badge <input type="text" name="home_hero_badge" value="{{ home.hero.badge }}" /></label>
            <label>Hero title <input type="text" name="home_hero_title" value="{{ home.hero.title }}" /></label>
            <label>
              Hero description
              <textarea name="home_hero_description">{{ home.hero.description }}</textarea>
            </label>
            <label>Hero CTA text <input type="text" name="home_hero_cta_text" value="{{ home.hero.cta_text }}" /></label>
            <label>Hero CTA link <input type="text" name="home_hero_cta_link" value="{{ home.hero.cta_link }}" /></label>
            <label>Hero image path
              <input type="text" name="home_hero_image" value="{{ home.hero.image }}" list="media-options" />
            </label>
            <label>Hero image alt text <input type="text" name="home_hero_image_alt" value="{{ home.hero.image_alt }}" /></label>
          </div>

          <h3>{{ home.what_we_print.title }}</h3>
          <div class="form-fields">
            <label>Section title
              <input type="text" name="home_what_we_print_heading" value="{{ home.what_we_print.title }}" />
            </label>
          </div>
          <div class="collection-wrapper">
            <div class="collection" data-collection="home_what_we_print">
              {% for item in home.what_we_print['items'] %}
                <div class="collection-item">
                  <div class="collection-item-header">
                    <strong>Card {{ loop.index }}</strong>
                    <button type="button" class="remove-item">Remove</button>
                  </div>
                  <label>Title <input type="text" name="home_what_we_print_title" value="{{ item.title }}" /></label>
                  <label>Description <textarea name="home_what_we_print_description">{{ item.description }}</textarea></label>
                  <label>
                    Card image (optional)
                    <input
                      type="text"
                      name="home_what_we_print_image"
                      value="{{ item.image | default('', true) }}"
                      list="media-options"
                    />
                  </label>
                  <label>
                    Card image alt text
                    <input
                      type="text"
                      name="home_what_we_print_image_alt"
                      value="{{ item.image_alt | default('', true) }}"
                    />
                  </label>
                  <label>Bullet list (one per line)
                    <textarea name="home_what_we_print_bullets">{{ item.bullets | join('\n') }}</textarea>
                  </label>
                </div>
              {% endfor %}
            </div>
            <button type="button" class="add-item" data-template="home_what_we_print_template">Add card</button>
          </div>
          <template id="home_what_we_print_template">
            <div class="collection-item">
              <div class="collection-item-header">
                <strong>New card</strong>
                <button type="button" class="remove-item">Remove</button>
              </div>
              <label>Title <input type="text" name="home_what_we_print_title" /></label>
              <label>Description <textarea name="home_what_we_print_description"></textarea></label>
              <label>
                Card image (optional)
                <input type="text" name="home_what_we_print_image" list="media-options" />
              </label>
              <label>
                Card image alt text
                <input type="text" name="home_what_we_print_image_alt" />
              </label>
              <label>Bullet list (one per line)
                <textarea name="home_what_we_print_bullets"></textarea>
              </label>
            </div>
          </template>

          <h3>{{ home.why_choose.title }}</h3>
          <div class="form-fields">
            <label>Section title
              <input type="text" name="home_why_choose_heading" value="{{ home.why_choose.title }}" />
            </label>
          </div>
          <div class="collection-wrapper">
            <div class="collection" data-collection="home_why_choose">
              {% for item in home.why_choose['items'] %}
                <div class="collection-item">
                  <div class="collection-item-header">
                    <strong>Card {{ loop.index }}</strong>
                    <button type="button" class="remove-item">Remove</button>
                  </div>
                  <label>Title <input type="text" name="home_why_choose_title" value="{{ item.title }}" /></label>
                  <label>Description <textarea name="home_why_choose_description">{{ item.description }}</textarea></label>
                  <label>
                    Icon/image (optional)
                    <input
                      type="text"
                      name="home_why_choose_image"
                      value="{{ item.image | default('', true) }}"
                      list="media-options"
                    />
                  </label>
                  <label>
                    Image alt text
                    <input
                      type="text"
                      name="home_why_choose_image_alt"
                      value="{{ item.image_alt | default('', true) }}"
                    />
                  </label>
                </div>
              {% endfor %}
            </div>
            <button type="button" class="add-item" data-template="home_why_choose_template">Add highlight</button>
          </div>
          <template id="home_why_choose_template">
            <div class="collection-item">
              <div class="collection-item-header">
                <strong>New highlight</strong>
                <button type="button" class="remove-item">Remove</button>
              </div>
              <label>Title <input type="text" name="home_why_choose_title" /></label>
              <label>Description <textarea name="home_why_choose_description"></textarea></label>
              <label>
                Icon/image (optional)
                <input type="text" name="home_why_choose_image" list="media-options" />
              </label>
              <label>
                Image alt text
                <input type="text" name="home_why_choose_image_alt" />
              </label>
            </div>
          </template>

          <h3>{{ home.testimonials.title }}</h3>
          <div class="form-fields">
            <label>Section title
              <input type="text" name="home_testimonials_heading" value="{{ home.testimonials.title }}" />
            </label>
          </div>
          <div class="collection-wrapper">
            <div class="collection" data-collection="home_testimonials">
              {% for item in home.testimonials['items'] %}
                <div class="collection-item">
                  <div class="collection-item-header">
                    <strong>Testimonial {{ loop.index }}</strong>
                    <button type="button" class="remove-item">Remove</button>
                  </div>
                  <label>Quote <textarea name="home_testimonials_quote">{{ item.quote }}</textarea></label>
                  <label>Attribution <input type="text" name="home_testimonials_author" value="{{ item.author }}" /></label>
                </div>
              {% endfor %}
            </div>
            <button type="button" class="add-item" data-template="home_testimonials_template">Add testimonial</button>
          </div>
          <template id="home_testimonials_template">
            <div class="collection-item">
              <div class="collection-item-header">
                <strong>New testimonial</strong>
                <button type="button" class="remove-item">Remove</button>
              </div>
              <label>Quote <textarea name="home_testimonials_quote"></textarea></label>
              <label>Attribution <input type="text" name="home_testimonials_author" /></label>
            </div>
          </template>
        </div>
      </article>

      <article class="section-card" data-section>
        <div class="section-toolbar">
          <div>
            <h2>Services page</h2>
            <p>Capabilities, bundles, and process</p>
          </div>
          <button type="button" class="edit-toggle" aria-expanded="false">Edit section</button>
        </div>
        <div class="section-preview">
          <div class="preview-grid">
            <dl>
              <dt>Hero title</dt>
              <dd>{{ services.hero.title }}</dd>
            </dl>
            <ul class="preview-list">
              <li>{{ services['capabilities'].title }} ({{ services['capabilities']['items'] | length }} capabilities)</li>
              <li>{{ services['bundles'].title }} ({{ services['bundles']['items'] | length }} bundles)</li>
              <li>{{ services.process.title }} ({{ services.process.steps | length }} steps)</li>
            </ul>
          </div>
        </div>
        <div class="section-body">
          <div class="form-fields">
            <label>Hero badge <input type="text" name="services_hero_badge" value="{{ services.hero.badge }}" /></label>
            <label>Hero title <input type="text" name="services_hero_title" value="{{ services.hero.title }}" /></label>
            <label>Hero description <textarea name="services_hero_description">{{ services.hero.description }}</textarea></label>
          </div>

          <h3>{{ services.capabilities.title }}</h3>
          <div class="form-fields">
            <label>Section title
              <input type="text" name="services_capabilities_heading" value="{{ services.capabilities.title }}" />
            </label>
          </div>
          <div class="collection-wrapper">
            <div class="collection" data-collection="services_capabilities">
              {% for item in services.capabilities['items'] %}
                <div class="collection-item">
                  <div class="collection-item-header">
                    <strong>Capability {{ loop.index }}</strong>
                    <button type="button" class="remove-item">Remove</button>
                  </div>
                  <label>Title <input type="text" name="services_capabilities_title" value="{{ item.title }}" /></label>
                  <label>Description <textarea name="services_capabilities_description">{{ item.description }}</textarea></label>
                  <label>
                    Feature image (optional)
                    <input
                      type="text"
                      name="services_capabilities_image"
                      value="{{ item.image | default('', true) }}"
                      list="media-options"
                    />
                  </label>
                  <label>
                    Image alt text
                    <input
                      type="text"
                      name="services_capabilities_image_alt"
                      value="{{ item.image_alt | default('', true) }}"
                    />
                  </label>
                  <label>Bullet list (one per line)
                    <textarea name="services_capabilities_bullets">{{ item.bullets | join('\n') }}</textarea>
                  </label>
                </div>
              {% endfor %}
            </div>
            <button type="button" class="add-item" data-template="services_capabilities_template">Add capability</button>
          </div>
          <template id="services_capabilities_template">
            <div class="collection-item">
              <div class="collection-item-header">
                <strong>New capability</strong>
                <button type="button" class="remove-item">Remove</button>
              </div>
              <label>Title <input type="text" name="services_capabilities_title" /></label>
              <label>Description <textarea name="services_capabilities_description"></textarea></label>
              <label>
                Feature image (optional)
                <input type="text" name="services_capabilities_image" list="media-options" />
              </label>
              <label>
                Image alt text
                <input type="text" name="services_capabilities_image_alt" />
              </label>
              <label>Bullet list (one per line)
                <textarea name="services_capabilities_bullets"></textarea>
              </label>
            </div>
          </template>

          <h3>{{ services.bundles.title }}</h3>
          <div class="form-fields">
            <label>Section title
              <input type="text" name="services_bundles_heading" value="{{ services.bundles.title }}" />
            </label>
          </div>
          <div class="collection-wrapper">
            <div class="collection" data-collection="services_bundles">
              {% for item in services.bundles['items'] %}
                <div class="collection-item">
                  <div class="collection-item-header">
                    <strong>Bundle {{ loop.index }}</strong>
                    <button type="button" class="remove-item">Remove</button>
                  </div>
                  <label>Title <input type="text" name="services_bundles_title" value="{{ item.title }}" /></label>
                  <label>Price <input type="text" name="services_bundles_price" value="{{ item.price }}" /></label>
                  <label>Description <textarea name="services_bundles_description">{{ item.description }}</textarea></label>
                  <label>
                    Bundle image (optional)
                    <input
                      type="text"
                      name="services_bundles_image"
                      value="{{ item.image | default('', true) }}"
                      list="media-options"
                    />
                  </label>
                  <label>
                    Image alt text
                    <input
                      type="text"
                      name="services_bundles_image_alt"
                      value="{{ item.image_alt | default('', true) }}"
                    />
                  </label>
                  <label>Bullet list (one per line)
                    <textarea name="services_bundles_bullets">{{ item.bullets | join('\n') }}</textarea>
                  </label>
                </div>
              {% endfor %}
            </div>
            <button type="button" class="add-item" data-template="services_bundles_template">Add bundle</button>
          </div>
          <template id="services_bundles_template">
            <div class="collection-item">
              <div class="collection-item-header">
                <strong>New bundle</strong>
                <button type="button" class="remove-item">Remove</button>
              </div>
              <label>Title <input type="text" name="services_bundles_title" /></label>
              <label>Price <input type="text" name="services_bundles_price" /></label>
              <label>Description <textarea name="services_bundles_description"></textarea></label>
              <label>
                Bundle image (optional)
                <input type="text" name="services_bundles_image" list="media-options" />
              </label>
              <label>
                Image alt text
                <input type="text" name="services_bundles_image_alt" />
              </label>
              <label>Bullet list (one per line)
                <textarea name="services_bundles_bullets"></textarea>
              </label>
            </div>
          </template>

          <h3>{{ services.process.title }}</h3>
          <div class="form-fields">
            <label>Section title
              <input type="text" name="services_process_heading" value="{{ services.process.title }}" />
            </label>
          </div>
          <div class="collection-wrapper">
            <div class="collection" data-collection="services_process">
              {% for item in services.process.steps %}
                <div class="collection-item">
                  <div class="collection-item-header">
                    <strong>Step {{ loop.index }}</strong>
                    <button type="button" class="remove-item">Remove</button>
                  </div>
                  <label>Title <input type="text" name="services_process_title" value="{{ item.title }}" /></label>
                  <label>Description <textarea name="services_process_description">{{ item.description }}</textarea></label>
                </div>
              {% endfor %}
            </div>
            <button type="button" class="add-item" data-template="services_process_template">Add step</button>
          </div>
          <template id="services_process_template">
            <div class="collection-item">
              <div class="collection-item-header">
                <strong>New step</strong>
                <button type="button" class="remove-item">Remove</button>
              </div>
              <label>Title <input type="text" name="services_process_title" /></label>
              <label>Description <textarea name="services_process_description"></textarea></label>
            </div>
          </template>
          <div class="form-fields">
            <label>Process CTA title <input type="text" name="services_process_cta_title" value="{{ services.process.cta.title }}" /></label>
            <label>Process CTA description <textarea name="services_process_cta_description">{{ services.process.cta.description }}</textarea></label>
            <label>Process CTA button text <input type="text" name="services_process_cta_text" value="{{ services.process.cta.text }}" /></label>
            <label>Process CTA link <input type="text" name="services_process_cta_link" value="{{ services.process.cta.link }}" /></label>
          </div>
        </div>
      </article>

      <article class="section-card" data-section>
        <div class="section-toolbar">
          <div>
            <h2>Contact page</h2>
            <p>Location, business hours, and form fields</p>
          </div>
          <button type="button" class="edit-toggle" aria-expanded="false">Edit section</button>
        </div>
        <div class="section-preview">
          <div class="preview-grid">
            <dl>
              <dt>Hero title</dt>
              <dd>{{ contact.hero.title }}</dd>
            </dl>
            <dl>
              <dt>Studio phone</dt>
              <dd>{{ contact.studio.phone or '–' }}</dd>
            </dl>
            <ul class="preview-list">
              <li>{{ contact.form.fields | length }} form fields</li>
              <li>{{ contact.about.cards | length }} about cards</li>
            </ul>
          </div>
        </div>
        <div class="section-body">
          <div class="form-fields">
            <label>Hero badge <input type="text" name="contact_hero_badge" value="{{ contact.hero.badge }}" /></label>
            <label>Hero title <input type="text" name="contact_hero_title" value="{{ contact.hero.title }}" /></label>
            <label>Hero description <textarea name="contact_hero_description">{{ contact.hero.description }}</textarea></label>
          </div>
          <div class="form-fields">
            <label>Visit title <input type="text" name="contact_visit_title" value="{{ contact.studio.visit_title }}" /></label>
            <label>Address (one per line)
              <textarea name="contact_address_lines">{{ contact.studio.address | join('\n') }}</textarea>
            </label>
            <label>Hours title <input type="text" name="contact_hours_title" value="{{ contact.studio.hours_title }}" /></label>
            <label>Hours (one per line)
              <textarea name="contact_hours_lines">{{ contact.studio.hours | join('\n') }}</textarea>
            </label>
            <label>Phone label <input type="text" name="contact_phone_title" value="{{ contact.studio.phone_title }}" /></label>
            <label>Phone number <input type="text" name="contact_phone" value="{{ contact.studio.phone }}" /></label>
            <label>Phone link <input type="text" name="contact_phone_href" value="{{ contact.studio.phone_href }}" /></label>
            <label>Email label <input type="text" name="contact_email_title" value="{{ contact.studio.email_title }}" /></label>
            <label>Email address <input type="email" name="contact_email" value="{{ contact.studio.email }}" /></label>
          </div>
          <div class="form-fields">
            <label>Form title <input type="text" name="contact_form_title" value="{{ contact.form.title }}" /></label>
            <label>Submit button text <input type="text" name="contact_form_submit" value="{{ contact.form.submit_text }}" /></label>
          </div>
          <div class="collection-wrapper">
            <div class="collection" data-collection="contact_form_fields">
              {% for field in contact.form.fields %}
                <div class="collection-item">
                  <div class="collection-item-header">
                    <strong>Field {{ loop.index }}</strong>
                    <button type="button" class="remove-item">Remove</button>
                  </div>
                  <label>Label <input type="text" name="contact_form_label" value="{{ field.label }}" /></label>
                  <label>Name <input type="text" name="contact_form_name" value="{{ field.name }}" /></label>
                  <label>Type
                    <select name="contact_form_type">
                      <option value="text" {% if field.type == 'text' %}selected{% endif %}>Text</option>
                      <option value="email" {% if field.type == 'email' %}selected{% endif %}>Email</option>
                      <option value="textarea" {% if field.type == 'textarea' %}selected{% endif %}>Textarea</option>
                    </select>
                  </label>
                  <label>Placeholder <input type="text" name="contact_form_placeholder" value="{{ field.placeholder }}" /></label>
                </div>
              {% endfor %}
            </div>
            <button type="button" class="add-item" data-template="contact_form_template">Add form field</button>
          </div>
          <template id="contact_form_template">
            <div class="collection-item">
              <div class="collection-item-header">
                <strong>New field</strong>
                <button type="button" class="remove-item">Remove</button>
              </div>
              <label>Label <input type="text" name="contact_form_label" /></label>
              <label>Name <input type="text" name="contact_form_name" /></label>
              <label>Type
                <select name="contact_form_type">
                  <option value="text">Text</option>
                  <option value="email">Email</option>
                  <option value="textarea">Textarea</option>
                </select>
              </label>
              <label>Placeholder <input type="text" name="contact_form_placeholder" /></label>
            </div>
          </template>

          <h3>{{ contact.about.title }}</h3>
          <label>About title <input type="text" name="contact_about_title" value="{{ contact.about.title }}" /></label>
          <label>About description <textarea name="contact_about_description">{{ contact.about.description }}</textarea></label>
          <div class="collection-wrapper">
            <div class="collection" data-collection="contact_about_cards">
              {% for card in contact.about.cards %}
                <div class="collection-item">
                  <div class="collection-item-header">
                    <strong>Card {{ loop.index }}</strong>
                    <button type="button" class="remove-item">Remove</button>
                  </div>
                  <label>Title <input type="text" name="contact_about_title_item" value="{{ card.title }}" /></label>
                  <label>Description <textarea name="contact_about_description_item">{{ card.description }}</textarea></label>
                </div>
              {% endfor %}
            </div>
            <button type="button" class="add-item" data-template="contact_about_template">Add card</button>
          </div>
          <template id="contact_about_template">
            <div class="collection-item">
              <div class="collection-item-header">
                <strong>New card</strong>
                <button type="button" class="remove-item">Remove</button>
              </div>
              <label>Title <input type="text" name="contact_about_title_item" /></label>
              <label>Description <textarea name="contact_about_description_item"></textarea></label>
            </div>
          </template>
        </div>
      </article>

      <div class="admin-actions">
        <button class="primary-button" type="submit">Save changes</button>
      </div>
    </form>

    <article class="section-card">
      <div class="section-toolbar">
        <div>
          <h2>Media library</h2>
          <p>Upload hero images or gallery assets</p>
        </div>
      </div>
      <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="action" value="upload_media" />
        <div class="form-fields">
          <label>Upload image
            <input type="file" name="media" accept="image/*" />
          </label>
          <div class="file-note">Files are stored in <code>{{ webroot_path }}/uploads</code> and can be referenced by using <code>/uploads/&lt;filename&gt;</code> in image fields.</div>
          <button class="primary-button" type="submit">Upload file</button>
        </div>
      </form>
      {% if uploads %}
        <div class="image-grid">
          {% for file in uploads %}
            <figure>
              <img src="{{ url_for('uploaded_file', filename=file) }}" alt="{{ file }}" />
              <figcaption>/uploads/{{ file }}</figcaption>
            </figure>
          {% endfor %}
        </div>
      {% else %}
        <p>No images uploaded yet.</p>
      {% endif %}
    </article>
  </section>
{% endblock %}
{% block extra_scripts %}
  <script>
    const sections = document.querySelectorAll('[data-section]');
    sections.forEach((section, index) => {
      const toggle = section.querySelector('.edit-toggle');
      if (!toggle) return;
      if (index !== 0) {
        toggle.textContent = 'Edit section';
        toggle.setAttribute('aria-expanded', 'false');
      }
      toggle.addEventListener('click', () => {
        const isEditing = section.classList.toggle('is-editing');
        toggle.textContent = isEditing ? 'Done' : 'Edit section';
        toggle.setAttribute('aria-expanded', String(isEditing));
      });
    });

    document.querySelectorAll('.add-item').forEach((button) => {
      button.addEventListener('click', () => {
        const template = document.getElementById(button.dataset.template);
        if (!template) return;
        const clone = template.content.firstElementChild.cloneNode(true);
        const wrapper = button.closest('.collection-wrapper');
        const collection = wrapper?.querySelector('.collection');
        collection?.appendChild(clone);
        attachRemoveHandlers(clone);
      });
    });

    function attachRemoveHandlers(scope = document) {
      scope.querySelectorAll('.remove-item').forEach((button) => {
        button.addEventListener('click', () => {
          const item = button.closest('.collection-item');
          item?.remove();
        });
      });
    }

    attachRemoveHandlers();
  </script>
{% endblock %}

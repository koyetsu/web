{% extends 'base.html' %}
{% block extra_head %}
  <style>
    .admin-dashboard {
      max-width: 1080px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 4rem;
      display: grid;
      gap: 2rem;
    }

    .admin-header {
      display: grid;
      gap: 0.75rem;
    }

    .admin-header h1 {
      margin: 0;
      font-size: clamp(2rem, 3vw, 2.6rem);
    }

    .admin-header p {
      margin: 0;
      color: var(--muted);
      max-width: 720px;
    }

    .alert {
      background: rgba(34, 197, 94, 0.12);
      border: 1px solid rgba(34, 197, 94, 0.25);
      color: #166534;
      padding: 0.9rem 1.1rem;
      border-radius: 14px;
      font-weight: 600;
    }

    .section-card {
      background: #ffffff;
      border-radius: 22px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 32px 70px -55px rgba(15, 23, 42, 0.6);
      padding: 1.8rem;
      display: grid;
      gap: 1.5rem;
    }

    .section-card header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .section-card header h2 {
      margin: 0;
      font-size: 1.35rem;
      color: var(--primary-dark);
    }

    .mode-status {
      font-weight: 600;
      margin: 0;
    }

    .mode-status.is-active {
      color: #b91c1c;
    }

    .mode-actions {
      display: grid;
      gap: 1rem;
    }

    .mode-actions p {
      margin: 0;
      color: var(--muted);
    }

    .mode-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .mode-buttons form {
      display: inline-flex;
    }

    .ghost-button {
      border: 1px solid rgba(37, 99, 235, 0.35);
      border-radius: 999px;
      padding: 0.55rem 1.4rem;
      font-weight: 600;
      background: #ffffff;
      color: var(--primary-dark);
      cursor: pointer;
    }

    .form-grid {
      display: grid;
      gap: 1.25rem;
    }

    .form-row {
      display: grid;
      gap: 1rem;
    }

    .form-row.two-column {
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .form-field {
      display: grid;
      gap: 0.4rem;
      font-weight: 600;
    }

    .form-field input,
    .form-field textarea,
    .form-field select {
      padding: 0.75rem 1rem;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      font: inherit;
      background: #ffffff;
    }

    .form-field textarea {
      min-height: 110px;
      resize: vertical;
    }

    .color-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    }

    .color-grid label {
      display: grid;
      gap: 0.35rem;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .file-note {
      font-size: 0.85rem;
      color: var(--muted);
    }

    @media (max-width: 768px) {
      .admin-toolbar {
        inset: auto 1rem 1rem 1rem;
      }

      body.admin-mode-active {
        padding-top: 5rem;
      }
    }
  </style>
{% endblock %}
{% block content %}
  <section class="admin-dashboard">
    <div class="admin-header">
      <h1>Site settings</h1>
      <p>
        Manage the global configuration for your print studio. Use the admin mode toggle to edit
        page content directly while previewing updates in real time.
      </p>
      {% if message %}
        <div class="alert">{{ message }}</div>
      {% endif %}
    </div>

    <article class="section-card">
      <header>
        <h2>Admin mode</h2>
      </header>
      <div class="mode-actions">
        {% if admin_mode %}
          <p class="mode-status is-active">Admin mode is currently active.</p>
          <p>Browse the public pages to edit content. Save or discard your draft when you are ready.</p>
          <div class="mode-buttons">
            <form method="post" action="{{ url_for('admin_mode_toggle') }}">
              <input type="hidden" name="action" value="save_exit" />
              <input type="hidden" name="next" value="{{ request.path }}" />
              <button class="primary-button" type="submit">Save &amp; exit</button>
            </form>
            <form method="post" action="{{ url_for('admin_mode_toggle') }}">
              <input type="hidden" name="action" value="discard_exit" />
              <input type="hidden" name="next" value="{{ request.path }}" />
              <button class="ghost-button" type="submit">Discard draft</button>
            </form>
          </div>
        {% else %}
          <p class="mode-status">Admin mode is off.</p>
          <p>Turn it on to open the inline editors on each page and preview updates before publishing.</p>
          <div class="mode-buttons">
            <form method="post" action="{{ url_for('admin_mode_toggle') }}">
              <input type="hidden" name="action" value="enter" />
              <input type="hidden" name="next" value="{{ url_for('home') }}" />
              <button class="primary-button" type="submit">Enter admin mode</button>
            </form>
          </div>
        {% endif %}
      </div>
    </article>

    <form method="post" class="section-card">
      <header>
        <h2>Branding &amp; theme</h2>
      </header>
      <input type="hidden" name="action" value="update_site_settings" />
      <div class="form-grid">
        <div class="form-row two-column">
          <label class="form-field">
            Business name
            <input type="text" name="site_name" value="{{ content.site.name }}" required />
          </label>
          <label class="form-field">
            Tagline
            <input type="text" name="site_tagline" value="{{ content.site.tagline }}" />
          </label>
        </div>
        <div class="form-row">
          <label class="form-field">
            Footer description
            <textarea name="footer_description">{{ content.site.footer.description }}</textarea>
          </label>
        </div>
        <div class="form-row two-column">
          <label class="form-field">
            Footer visit lines (one per row)
            <textarea name="footer_visit_lines">{{ content.site.footer.visit.lines | join('\n') }}</textarea>
          </label>
          <label class="form-field">
            Footer contact lines (Label|URL â€” leave URL empty for plain text)
            <textarea name="footer_contact_lines">{% for line in content.site.footer.contact.lines %}{{ line.label }}{% if line.url %}|{{ line.url }}{% endif %}{% if not loop.last %}\n{% endif %}{% endfor %}</textarea>
          </label>
        </div>
        <div class="form-row">
          <div class="color-grid">
            <label>
              Primary color
              <input type="color" name="color_primary" value="{{ content.site.colors.primary }}" />
            </label>
            <label>
              Primary (dark)
              <input type="color" name="color_primary_dark" value="{{ content.site.colors.primary_dark }}" />
            </label>
            <label>
              Accent
              <input type="color" name="color_accent" value="{{ content.site.colors.accent }}" />
            </label>
            <label>
              Background
              <input type="color" name="color_background" value="{{ content.site.colors.background }}" />
            </label>
            <label>
              Body text
              <input type="color" name="color_text" value="{{ content.site.colors.text }}" />
            </label>
            <label>
              Muted text
              <input type="color" name="color_muted" value="{{ content.site.colors.muted }}" />
            </label>
          </div>
        </div>
        <div class="form-row">
          <label class="form-field">
            Set new admin password
            <input type="password" name="admin_password" placeholder="Enter new password" autocomplete="new-password" />
            <span class="field-help">
              {% if admin_password_state == 'custom' %}
                Using a custom password.
              {% elif admin_password_state == 'empty' %}
                No password is currently required.
              {% else %}
                The default password is active.
              {% endif %}
            </span>
          </label>
        </div>
      </div>
      <button class="primary-button" type="submit">Save settings</button>
    </form>

    <article class="section-card">
      <header>
        <h2>Media library</h2>
      </header>
      <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="action" value="upload_media" />
        <div class="form-row two-column">
          <label class="form-field">
            Upload image
            <input type="file" name="media" accept="image/*" />
          </label>
          <div class="file-note">
            Files are saved to <code>{{ webroot_path }}/uploads</code>. Reference them with
            <code>/uploads/&lt;filename&gt;</code> when editing page content.
          </div>
        </div>
        <button class="primary-button" type="submit">Upload file</button>
      </form>
      {% if uploads %}
        <div class="image-grid">
          {% for file in uploads %}
            <figure>
              <img src="{{ url_for('uploaded_file', filename=file) }}" alt="{{ file }}" />
              <figcaption>/uploads/{{ file }}</figcaption>
            </figure>
          {% endfor %}
        </div>
      {% else %}
        <p>No images uploaded yet.</p>
      {% endif %}
    </article>
  </section>
{% endblock %}
{% block extra_scripts %}{% endblock %}
